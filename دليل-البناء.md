# دليل بناء تطبيق إدارة المديونيات

## المتطلبات الأساسية

### 1. تثبيت Node.js
- تحميل من: https://nodejs.org
- النسخة الحالية المثبتة: v22.14.0 ✅

### 2. تثبيت Java JDK
- تحميل Java JDK 17 أو 11 من: https://adoptium.net
- بعد التثبيت، تأكد من إضافة JAVA_HOME إلى متغيرات البيئة

**خطوات إعداد JAVA_HOME:**
```powershell
# افتح PowerShell كمسؤول وقم بتشغيل:
[Environment]::SetEnvironmentVariable("JAVA_HOME", "C:\Program Files\Eclipse Adoptium\jdk-17.0.x-hotspot", "Machine")
```

### 3. تثبيت Android Studio و SDK
- تحميل Android Studio من: https://developer.android.com/studio
- بعد التثبيت، افتح Android Studio واذهب إلى:
  - Tools → SDK Manager
  - قم بتثبيت:
    - Android SDK Platform 33
    - Android SDK Build-Tools 33.x.x
    - Android SDK Command-line Tools

**خطوات إعداد ANDROID_HOME:**
```powershell
# افتح PowerShell كمسؤول وقم بتشغيل:
[Environment]::SetEnvironmentVariable("ANDROID_HOME", "$env:LOCALAPPDATA\Android\Sdk", "Machine")
[Environment]::SetEnvironmentVariable("Path", "$env:Path;$env:LOCALAPPDATA\Android\Sdk\platform-tools;$env:LOCALAPPDATA\Android\Sdk\tools", "Machine")
```

### 4. تثبيت Gradle (اختياري - عادة يأتي مع Android Studio)
- Gradle سيتم تنزيله تلقائياً عند البناء الأول

---

## خطوات البناء

### الخطوة 1: تثبيت Cordova عالمياً
```powershell
npm install -g cordova
```
✅ **تم التنفيذ**

### الخطوة 2: تثبيت الحزم المطلوبة
```powershell
npm install
```

### الخطوة 3: إنشاء مجلد www (تم بالفعل)
```powershell
New-Item -ItemType Directory -Force -Path www
Copy-Item index.html, app.js, style.css, "شعار.png" -Destination www\
```
✅ **تم التنفيذ**

### الخطوة 4: إضافة منصة Android
```powershell
npx cordova platform add android
```
✅ **تم التنفيذ**

### الخطوة 5: بناء التطبيق (بعد تثبيت Android SDK)
```powershell
npx cordova build android
```

### الخطوة 6: بناء نسخة الإصدار (Release)
```powershell
npx cordova build android --release
```

---

## مواقع ملفات APK بعد البناء

### نسخة التطوير (Debug):
```
platforms\android\app\build\outputs\apk\debug\app-debug.apk
```

### نسخة الإصدار (Release):
```
platforms\android\app\build\outputs\apk\release\app-release-unsigned.apk
```

---

## توقيع نسخة الإصدار (اختياري)

### 1. إنشاء مفتاح التوقيع
```powershell
keytool -genkey -v -keystore mdiyoniyat.keystore -alias mdiyoniyat -keyalg RSA -keysize 2048 -validity 10000
```

### 2. توقيع التطبيق
```powershell
jarsigner -verbose -sigalg SHA256withRSA -digestalg SHA-256 -keystore mdiyoniyat.keystore platforms\android\app\build\outputs\apk\release\app-release-unsigned.apk mdiyoniyat
```

### 3. تحسين APK
```powershell
zipalign -v 4 platforms\android\app\build\outputs\apk\release\app-release-unsigned.apk mdiyoniyat-signed.apk
```

---

## حل المشاكل الشائعة

### المشكلة: ANDROID_HOME غير معرّف
**الحل:**
1. ثبّت Android Studio
2. افتح SDK Manager واختر Platform 33
3. أضف متغير البيئة ANDROID_HOME

### المشكلة: Java JDK غير موجود
**الحل:**
1. ثبّت Java JDK 17
2. أضف JAVA_HOME إلى متغيرات البيئة
3. أعد تشغيل PowerShell

### المشكلة: Gradle Build فشل
**الحل:**
```powershell
cd platforms\android
.\gradlew clean
cd ..\..
npx cordova build android
```

---

## طريقة بديلة: استخدام البناء السريع (بدون Android Studio)

إذا كنت لا تريد تثبيت Android Studio، يمكنك:

### 1. استخدام خدمة بناء سحابية مثل:
- **PhoneGap Build** (تتطلب حساب Adobe)
- **Ionic Appflow** (مجاني للمشاريع الصغيرة)

### 2. استخدام GitHub Actions للبناء التلقائي
قمنا بإنشاء ملف `.github/workflows/build.yml` للبناء التلقائي على GitHub

---

## الملفات الأساسية للمشروع

- **config.xml** - تكوين Cordova الأساسي
- **package.json** - تبعيات Node.js
- **www/** - ملفات التطبيق (HTML, CSS, JS)
- **platforms/android/** - ملفات منصة Android
- **build.bat** - سكريبت بناء للويندوز (CMD)
- **build.ps1** - سكريبت بناء للويندوز (PowerShell)

---

## البناء باستخدام السكريبتات الجاهزة

### باستخدام PowerShell:
```powershell
.\build.ps1
```

### باستخدام CMD:
```cmd
build.bat
```

---

## التثبيت على الجهاز

### عبر USB:
```powershell
npx cordova run android --device
```

### عبر ADB مباشرة:
```powershell
adb install platforms\android\app\build\outputs\apk\debug\app-debug.apk
```

### عبر نسخ الملف:
- انسخ ملف APK إلى الهاتف
- افتح الملف من مدير الملفات
- اسمح بتثبيت التطبيقات من مصادر غير معروفة

---

## معلومات المشروع

- **اسم التطبيق:** إدارة مديونيات
- **معرف الحزمة:** com.mdiyoniyat.app
- **الإصدار:** 1.0.0
- **المنصة:** Android (API 24-33)
- **الإطار:** Apache Cordova
- **الإضافات:** cordova-plugin-contacts

---

## الدعم

إذا واجهت أي مشاكل:
1. تأكد من تثبيت جميع المتطلبات
2. تحقق من متغيرات البيئة
3. أعد تشغيل PowerShell/CMD بعد تعديل المتغيرات
4. راجع سجلات الأخطاء في مجلد platforms/android

**ملاحظة:** تأكد من تشغيل PowerShell كمسؤول عند تعديل متغيرات البيئة.
